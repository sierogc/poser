<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Poser</title>
    <style>
        /* VARIABILE: Dimensione di default per desktop */
        :root {
            --main-font-size: 5.5rem; 
        }

        /* --- MEDIA QUERY PER RENDERE RESPONSIVE --- */
        /* Se la larghezza dello schermo è 600px o meno (tipico smartphone) */
        @media (max-width: 600px) {
            :root {
                --main-font-size: 3rem; /* Riduzione della dimensione del font */
            }
            #distance, #timer {
                /* Allentiamo leggermente il kerning per una migliore leggibilità su schermi piccoli */
                letter-spacing: -1px !important; 
            }
        }
        
        body, html {
            height: 100%;
            margin: 0;
            
            /* GESTIONE SFONDO */
            background-image: url('wallpaper.jpg'); 
            background-size: cover; 
            background-position: center; 
            background-attachment: fixed; 
            background-color: black; 
            
            /* GESTIONE TESTO */
            color: white; 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* RIGA 1: Distanza */
        #distance {
            font-size: var(--main-font-size); 
            font-weight: 700; 
            letter-spacing: -2px; 
            margin-bottom: 5px; 
            line-height: 1.1;
            font-feature-settings: "tnum"; 
        }

        /* RIGA 2: Timer */
        #timer {
            font-size: var(--main-font-size);
            font-weight: 700;
            letter-spacing: -2px; 
            font-feature-settings: "tnum";
            color: white; 
        }
        
        .loading {
            color: #666; 
        }
    </style>
</head>
<body>

    <div class="status-container">
        <div id="distance" class="loading">... km</div>
        <div id="timer">00:00:00</div>
    </div>

    <script>
        // --- 1. LE TUE COORDINATE (Mariglianella, Via Roma 37) ---
        const MY_LAT = 40.9178; 
        const MY_LON = 14.4375; 

        // --- 2. GESTIONE TIMER PERSISTENTE ---
        const timerElement = document.getElementById('timer');
        let startTime = localStorage.getItem('firstConnectionTime');

        if (!startTime) {
            startTime = Date.now();
            localStorage.setItem('firstConnectionTime', startTime);
        } else {
            startTime = parseInt(startTime);
        }

        function updateTimer() {
            const diff = Date.now() - startTime; 
            const totalSeconds = Math.floor(diff / 1000);
            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = totalSeconds % 60;

            const formattedTime = 
                (hours < 10 ? "0" + hours : hours) + ":" + 
                (minutes < 10 ? "0" + minutes : minutes) + ":" + 
                (seconds < 10 ? "0" + seconds : seconds);

            timerElement.textContent = formattedTime;
        }
        
        setInterval(updateTimer, 1000);
        updateTimer(); 

        // --- 3. LOGICA CALCOLO DISTANZA ---
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; 
            const dLat = deg2rad(lat2 - lat1);
            const dLon = deg2rad(lon2 - lon1);
            const a = 
                Math.sin(dLat/2) * Math.sin(dLat/2) +
                Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) * Math.sin(dLon/2) * Math.sin(dLon/2); 
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); 
            return R * c; 
        }

        function deg2rad(deg) {
            return deg * (Math.PI/180);
        }

        fetch('https://ipapi.co/json/')
            .then(response => response.json())
            .then(data => {
                const distanceElem = document.getElementById('distance');
                if (data.latitude && data.longitude) {
                    const dist = calculateDistance(MY_LAT, MY_LON, data.latitude, data.longitude);
                    distanceElem.className = ""; 
                    distanceElem.textContent = `${dist.toFixed(1)} km`;
                } else {
                    distanceElem.textContent = "XXX.X km";
                    distanceElem.className = "loading";
                }
            })
            .catch(error => {
                console.error(error);
                document.getElementById('distance').textContent = "XXX.X km";
            });
    </script>
</body>
</html>
